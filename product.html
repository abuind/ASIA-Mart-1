<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - Asia Mart</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>Asia Mart</h1>
                    <p>Natural Cosmetics & Groceries</p>
                </div>
                <nav class="nav">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="index.html#products" class="nav-link">Products</a>
                    <a href="cart.html" class="nav-link">
                        Cart <span class="cart-count">0</span>
                    </a>
                    <a href="login.html" class="nav-link" id="loginLink">Login</a>
                    <a href="#" class="nav-link" id="logoutLink" style="display: none;">Logout</a>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <a href="index.html" class="back-link">‚Üê Back to Products</a>
            <div id="productDetails" class="product-details">
                <!-- Product details will be loaded here -->
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Asia Mart</h3>
                    <p>Your trusted source for natural cosmetics and organic groceries.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <a href="index.html">Home</a>
                    <a href="index.html#products">Products</a>
                    <a href="cart.html">Cart</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Asia Mart. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/db.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/products.js"></script>
    <script src="js/cart.js"></script>
    <script>
        let dbReady = false;
        const initInterval = setInterval(() => {
            if (db) {
                dbReady = true;
                clearInterval(initInterval);
                initPage();
            }
        }, 100);

        async function initPage() {
            if (isCustomerLoggedIn()) {
                document.getElementById('loginLink').style.display = 'none';
                document.getElementById('logoutLink').style.display = 'inline';
                document.getElementById('logoutLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    logout();
                });
            }

            await updateCartCountDisplay();

            const productId = parseInt(getQueryParam('id'));
            if (!productId) {
                window.location.href = 'index.html';
                return;
            }

            await loadProductDetails(productId);
        }

        async function loadProductDetails(productId) {
            const product = await getProductById(productId);
            if (!product) {
                showNotification('Product not found', 'error');
                setTimeout(() => window.location.href = 'index.html', 2000);
                return;
            }

            const detailsDiv = document.getElementById('productDetails');
            detailsDiv.innerHTML = `
                <div class="product-detail-container">
                    <div class="product-detail-image">
                        <img src="${product.image}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/500x500?text=Product'">
                    </div>
                    <div class="product-detail-info">
                        <h1>${product.name}</h1>
                        <p class="product-category">${product.category}</p>
                        <p class="product-sku">SKU: ${product.sku}</p>
                        <p class="product-description-full">${product.description}</p>
                        <div class="product-price-large">${formatCurrency(product.price)}</div>
                        <div class="stock-info">
                            ${product.stock > 10 ? 
                                `<span class="in-stock">In Stock (${product.stock} available)</span>` : 
                                product.stock > 0 ? 
                                    `<span class="low-stock">Low Stock (${product.stock} available)</span>` : 
                                    `<span class="out-of-stock">Out of Stock</span>`
                            }
                        </div>
                        <div class="add-to-cart-section">
                            <label for="quantity">Quantity:</label>
                            <input type="number" id="quantity" min="1" max="${product.stock}" value="1" ${product.stock === 0 ? 'disabled' : ''}>
                            <button class="btn btn-primary btn-large" id="addToCartBtn" ${product.stock === 0 ? 'disabled' : ''}>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('addToCartBtn').addEventListener('click', async () => {
                const quantity = parseInt(document.getElementById('quantity').value) || 1;
                const result = await addToCart(productId, quantity);
                if (result.success) {
                    showNotification(result.message, 'success');
                    await updateCartCountDisplay();
                } else {
                    showNotification(result.message, 'error');
                }
            });
        }
    </script>
</body>
</html>

